const VERSION_DAY = "05";
const VERSION_MONTH = "02";
const VERSION_YEAR = "2023";

const PWA_VERSION = VERSION_DAY + VERSION_MONTH + VERSION_YEAR;

const PWA_PREFIX = "sainternet_";
const PWA_VERSION_PREFIX = "version_";

const PWA_CACHE_NAME = PWA_PREFIX + PWA_VERSION_PREFIX + PWA_VERSION;

const APP_URLS = [
  "https://sainternet.xyz/pwapp.min.js",
  "https://sainternet.xyz/pwapp-serviceworker.min.js",
  "https://sainternet.xyz/sainternet.webmanifest"
];

const CSS_URLS = [
  "https://sainternet.xyz/resources/fontawesome/css/brands.min.css",
  "https://sainternet.xyz/resources/fontawesome/css/fontawesome.min.css",
  "https://sainternet.xyz/resources/fontawesome/css/solid.min.css",
  "https://sainternet.xyz/resources/stylesheets/button_home.min.css",
  "https://sainternet.xyz/resources/stylesheets/datetime.min.css",
  "https://sainternet.xyz/resources/stylesheets/img.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.amber-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.blue_grey-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.blue-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.brown-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.cyan-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.deep_orange-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.deep_purple-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.green-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.grey-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.indigo-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.light_blue-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.light_green-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.lime-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.orange-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.pink-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.purple-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.red-blue.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.teal-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/material.yellow-red.min.css",
  "https://sainternet.xyz/resources/stylesheets/pre.min.css",
  "https://sainternet.xyz/resources/stylesheets/ribbons.min.css",
  "https://sainternet.xyz/resources/stylesheets/sainternet.min.css",
  "https://sainternet.xyz/resources/stylesheets/sainternet-new.min.css",
  "https://sainternet.xyz/resources/stylesheets/table.min.css"
];

const DOWNLOAD_URLS = [
  "https://sainternet.xyz/downloads/apple/sainternet-https-and-tls.mobileconfig",
  "https://sainternet.xyz/downloads/apple/sainternet-https-only.mobileconfig",
  "https://sainternet.xyz/downloads/apple/sainternet-tls-only.mobileconfig"
];

const HTML_URLS = [
  "https://sainternet.xyz",
  "https://sainternet.xyz/",
  "https://sainternet.xyz/265.html",
  "https://sainternet.xyz/404.html",
  "https://sainternet.xyz/connecttosainternet.html",
  "https://sainternet.xyz/filtereddns.html",
  "https://sainternet.xyz/frequentlyaskedquestions.html",
  "https://sainternet.xyz/index.html",
  "https://sainternet.xyz/new",
  "https://sainternet.xyz/new/",
  "https://sainternet.xyz/new/index.html",
  "https://sainternet.xyz/newsandupdates.html",
  "https://sainternet.xyz/pokedexoverdns.html",
  "https://sainternet.xyz/portsandprotocols.html",
  "https://sainternet.xyz/projects.html",
  "https://sainternet.xyz/reportaproblem.html",
  "https://sainternet.xyz/technologies.html",
  "https://sainternet.xyz/testsainternet.html"
];

const FONT_URLS = [
  "https://sainternet.xyz/resources/fontawesome/webfonts/fa-brands-400.ttf",
  "https://sainternet.xyz/resources/fontawesome/webfonts/fa-brands-400.woff2",
  "https://sainternet.xyz/resources/fontawesome/webfonts/fa-solid-900.ttf",
  "https://sainternet.xyz/resources/fontawesome/webfonts/fa-solid-900.woff2"
];

const ICON_URLS = [
  "https://sainternet.xyz/favicon.ico",
  "https://sainternet.xyz/resources/icons/android-chrome-192x192.png",
  "https://sainternet.xyz/resources/icons/android-chrome-256x256.png",
  "https://sainternet.xyz/resources/icons/android-chrome-265-192x192.png",
  "https://sainternet.xyz/resources/icons/android-chrome-265-256x256.png",
  "https://sainternet.xyz/resources/icons/android-chrome-404-192x192.png",
  "https://sainternet.xyz/resources/icons/android-chrome-404-256x256.png",
  "https://sainternet.xyz/resources/icons/favicon-16x16.png",
  "https://sainternet.xyz/resources/icons/favicon-265-16x16.png",
  "https://sainternet.xyz/resources/icons/favicon-265-32x32.png",
  "https://sainternet.xyz/resources/icons/favicon-265-48x48.png",
  "https://sainternet.xyz/resources/icons/favicon-265.ico",
  "https://sainternet.xyz/resources/icons/favicon-32x32.png",
  "https://sainternet.xyz/resources/icons/favicon-404-16x16.png",
  "https://sainternet.xyz/resources/icons/favicon-404-32x32.png",
  "https://sainternet.xyz/resources/icons/favicon-404-48x48.png",
  "https://sainternet.xyz/resources/icons/favicon-404.ico",
  "https://sainternet.xyz/resources/icons/favicon-48x48.png",
  "https://sainternet.xyz/resources/icons/filtereddns-192x192.png",
  "https://sainternet.xyz/resources/icons/mstile-144x144.png",
  "https://sainternet.xyz/resources/icons/newsandupdates-192x192.png",
  "https://sainternet.xyz/resources/icons/pokedexoverdns-192x192.png",
  "https://sainternet.xyz/resources/icons/projects-192x192.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-128x128.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-192x192.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-384x384.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-48x48.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-512x512.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-72x72.png",
  "https://sainternet.xyz/resources/icons/pwa-maskable-96x96.png"
];

const IMAGE_URLS = [
  "https://sainternet.xyz/resources/images/luxio.jpg",
  "https://sainternet.xyz/resources/images/luxio.png",
  "https://sainternet.xyz/resources/images/luxio-shiny.jpg",
  "https://sainternet.xyz/resources/images/luxio-shiny.png",
  "https://sainternet.xyz/resources/images/luxio-shiny.webp",
  "https://sainternet.xyz/resources/images/luxio.webp",
  "https://sainternet.xyz/resources/images/terminal.jpg",
  "https://sainternet.xyz/resources/images/terminal.png",
  "https://sainternet.xyz/resources/images/terminal.webp",
  "https://sainternet.xyz/resources/images/wurmple.jpg",
  "https://sainternet.xyz/resources/images/wurmple.png",
  "https://sainternet.xyz/resources/images/wurmple-shiny.jpg",
  "https://sainternet.xyz/resources/images/wurmple-shiny.png",
  "https://sainternet.xyz/resources/images/wurmple-shiny.webp",
  "https://sainternet.xyz/resources/images/wurmple.webp"
];

const JS_URLS = [
  "https://sainternet.xyz/resources/javascript/headers.min.js",
  "https://sainternet.xyz/resources/javascript/load-fonts.min.js",
  "https://sainternet.xyz/resources/javascript/material.min.js",
  "https://sainternet.xyz/resources/javascript/random_phrase.min.js",
  "https://sainternet.xyz/resources/javascript/sainternet.min.js",
  "https://sainternet.xyz/resources/javascript/sainternet-new.min.js"
];

const LICENSE_URLS = [
  "https://sainternet.xyz/LICENSE",
  "https://sainternet.xyz/resources/fontawesome/LICENSE.txt"
];

const SCREENSHOT_URLS = [
  "https://sainternet.xyz/resources/screenshots/home.webp",
  "https://sainternet.xyz/resources/screenshots/newsandupdates.webp",
  "https://sainternet.xyz/resources/screenshots/filtereddns.webp",
  "https://sainternet.xyz/resources/screenshots/pokedexoverdns.webp",
  "https://sainternet.xyz/resources/screenshots/popularprojects.webp"
];

const ALL_URLS = APP_URLS.concat(CSS_URLS, DOWNLOAD_URLS, HTML_URLS, FONT_URLS, ICON_URLS, IMAGE_URLS, JS_URLS, LICENSE_URLS, SCREENSHOT_URLS);

self.addEventListener("fetch", function (e) {
  //console.log("[Service Worker] Fetching Resource: " + e.request.url);
  e.respondWith(
    caches.match(e.request).then(function (request) {
      if (request) {
        //console.log("[Service Worker] Cache Hit: " + e.request.url);
        return request;
      } else {
        //console.log("[Service Worker] Cache Miss: " + e.request.url);
        return fetch(e.request);
        //console.log("[Service Worker] Cache Put: " + e.request.url);
        return cache.put(e.request, request.clone());
      }
    })
  );
});

self.addEventListener("install", function (e) {
  self.skipWaiting();
  e.waitUntil(
    caches.open(PWA_CACHE_NAME).then(function (cache) {
      //console.log("[Service Worker] Opening Cache: " + PWA_CACHE_NAME);
      return cache.addAll(ALL_URLS);
    })
    .catch(function(e) {
      //console.log("[Service Worker] Error Opening Cache", e);
    })
  );
});

self.addEventListener("activate", function (e) {
  if (self.clients && clients.claim) {
    //console.log("[Service Worker] Claiming Client(s)");
    clients.claim();
  }
  //console.log("[Service Worker] Checking Cache(s)");
  e.waitUntil(
    caches.keys().then(function (keyList) {
      var cacheWhitelist = keyList.filter(function (key) {
        return key.indexOf(PWA_PREFIX);
      });
      //console.log("[Service Worker] Whitelisting Cache: " + PWA_CACHE_NAME);
      cacheWhitelist.push(PWA_CACHE_NAME);
      return Promise.all(keyList.map(function (key, i) {
        if (cacheWhitelist.indexOf(key) === -1) {
          //console.log("[Service Worker] Removing Orphaned Cache(s): " + keyList[i] );
          return caches.delete(keyList[i]);
        }
      }));
    })
  );
});
