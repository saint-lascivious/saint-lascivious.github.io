const baseDomain="https://sainternet.xyz",shortName="sainternet",cacheVersionPrefix="_v",cacheVersion="67",cacheName=`${shortName}_v67`,htmlCritical=[`${baseDomain}/`,`${baseDomain}/265.html`,`${baseDomain}/404.html`,`${baseDomain}/connecttosainternet.html`,`${baseDomain}/debug.html`,`${baseDomain}/filtereddns.html`,`${baseDomain}/frequentlyaskedquestions.html`,`${baseDomain}/index.html`,`${baseDomain}/newsandupdates.html`,`${baseDomain}/pokedexoverdns.html`,`${baseDomain}/portsandprotocols.html`,`${baseDomain}/projects.html`,`${baseDomain}/reportaproblem.html`,`${baseDomain}/technologies.html`,`${baseDomain}/testsainternet.html`,],cssCritical=[`${baseDomain}/resources/fontawesome-free-6.3.0-web/css/brands.min.css`,`${baseDomain}/resources/fontawesome-free-6.3.0-web/css/fontawesome.min.css`,`${baseDomain}/resources/fontawesome-free-6.3.0-web/css/solid.min.css`,`${baseDomain}/resources/google/css/materialicons.min.css`,`${baseDomain}/resources/google/css/roboto.min.css`,`${baseDomain}/resources/stylesheets/button_home.min.css`,`${baseDomain}/resources/stylesheets/datetime.min.css`,`${baseDomain}/resources/stylesheets/img.min.css`,`${baseDomain}/resources/stylesheets/pre.min.css`,`${baseDomain}/resources/stylesheets/ribbons.min.css`,`${baseDomain}/resources/stylesheets/sainternet.min.css`,`${baseDomain}/resources/stylesheets/table.min.css`,],jsCritical=[`${baseDomain}/resources/javascript/console_wrapper.min.js`,`${baseDomain}/resources/javascript/debug.min.js`,`${baseDomain}/resources/javascript/load_fonts.min.js`,`${baseDomain}/resources/javascript/material.min.js`,`${baseDomain}/resources/javascript/random_phrase.min.js`,`${baseDomain}/resources/javascript/tag_manager.min.js`,`${baseDomain}/resources/javascript/toggle_drawer.min.js`,`${baseDomain}/sainternet.min.js`,],cacheCritical=[...htmlCritical,...cssCritical,...jsCritical,],cacheOriginDomains=[baseDomain,];function consoleWrapper(e,r="log",o=!1){self.DEBUG&&o&&(e=`${new Date().toLocaleString()} - ${e}`),self.DEBUG&&"object"==typeof console&&"function"==typeof console[r]&&console[r](e)}function consoleWrapperSimple(e,r="log"){"object"==typeof console&&"function"==typeof console[r]&&console[r](e)}function cacheUrls(e){return caches.open(cacheName).then(function(r){return Promise.all(e.map(function(e){return fetch(e).then(function(o){return o.ok||consoleWrapper(`[Service Worker] Failed to cache ${e}: ${o.status}`,"error"),r.put(e,o)}).then(function(){consoleWrapper(`[Service Worker] Cached ${e}: ${response.status}`)})}))})}function sleepFor(e){let r=new Date().getTime();for(;new Date().getTime()<r+e;);}self.addEventListener("install",function(e){consoleWrapper(`[Service Worker] Event: install ${shortName}`);try{e.waitUntil(cacheUrls(cacheCritical).then(function(){return consoleWrapper("[Service Worker] Finished caching critical assets"),self.skipWaiting()}).catch(function(e){consoleWrapper(`[Service Worker] Error during cache fetch: ${e}`,"error")}))}catch(r){consoleWrapper(`[Service Worker] Error during install event: ${r}`,"error")}}),self.addEventListener("activate",function(e){consoleWrapper(`[Service Worker] Event: activate ${shortName}`);try{self.clients&&clients.claim&&(consoleWrapper("[Service Worker] Claiming available clients"),clients.claim()),e.waitUntil(caches.keys().then(function(e){let r=e.filter(function(e){return e.indexOf(shortName)});return r.push(cacheName),Promise.all(e.map(function(o,n){if(-1===r.indexOf(o))return console.log(`[Service Worker] Deleting orphaned cache: ${e[n]}`),caches.delete(e[n])}))}))}catch(r){consoleWrapper(`[Service Worker] Error during activate event: ${r}`,"error")}}),self.addEventListener("fetch",function(e){try{if("GET"!==e.request.method){consoleWrapper(`[Service Worker] Not handling request ${e.request.url} with method ${e.request.method}`);return}let r=new URL(e.request.url);cacheCritical.includes(r.pathname)&&cacheOriginDomains.some(e=>r.origin.startsWith(e))?e.respondWith(fetch(e.request).then(function(r){if(!r||200!==r.status||"basic"!==r.type)return consoleWrapper(`[Service Worker] Response not eligible for caching: ${e.request.url}`),r;if(cacheOriginDomains.some(e=>new URL(r.url).origin.startsWith(e))){let o=r.clone();caches.open(cacheName).then(function(r){consoleWrapper(`[Service Worker] Adding response to cache: ${e.request.url}`),r.put(e.request,o)})}return consoleWrapper(`[Service Worker] Returning response from network: ${e.request.url}`),r}).catch(function(r){return consoleWrapper(`[Service Worker] Network fetch failed, falling back to cache for: ${e.request.url}`),caches.match(e.request).then(function(r){return r?consoleWrapper(`[Service Worker] Returning response from cache: ${e.request.url}`):consoleWrapper(`[Service Worker] No response available in cache for: ${e.request.url}`),r})})):e.respondWith(caches.match(e.request).then(function(r){return r?(consoleWrapper(`[Service Worker] Returning response from cache: ${e.request.url}`),r):(consoleWrapper(`[Service Worker] No response available in cache for: ${e.request.url}`),fetch(e.request))}).then(function(r){if(!r||200!==r.status||"basic"!==r.type)return consoleWrapper(`[Service Worker] Response not eligible for caching: ${e.request.url}`),r;let o=r.clone();return caches.open(cacheName).then(function(r){consoleWrapper(`[Service Worker] Adding response to cache: ${e.request.url}`),r.put(e.request,o)}),consoleWrapper(`[Service Worker] Returning response from network: ${e.request.url}`),r}).catch(function(r){consoleWrapper(`[Service Worker] Fetch failed for: ${e.request.url}`)}))}catch(o){consoleWrapper(`[Service Worker] Error during fetch event: ${o}`,"error")}}),self.addEventListener("onupdatefound",function(e){consoleWrapper("[Service Worker] Service worker update found")}),self.addEventListener("controllerchange",function(e){consoleWrapper("[Service Worker] Service worker controller changed")}),self.addEventListener("updatefound",e=>{let r={installing:"New service worker version installing",installed:"New service worker version installed",activating:"New service worker version activating",activated:"New service worker version activated",redundant:"New service worker version redundant"};consoleWrapper("[Service Worker] Event: updatefound");let o=e.target.installing;o.addEventListener("statechange",()=>{consoleWrapper(`[Service Worker] ${r[o.state]}`)})}),self.addEventListener("message",function(e){if("debug"===e.data.type){let r=e.data.value;self.DEBUG=r,consoleWrapperSimple(`[Service Worker] DEBUG: ${r}`)}else if("info"===e.data)consoleWrapperSimple(`[Service Worker] Name: ${shortName}`),consoleWrapperSimple("[Service Worker] Cache version: 67"),consoleWrapperSimple(`[Service Worker] Cache name: ${cacheName}`),consoleWrapperSimple(`[Service Worker] Scope: ${baseDomain}`);else if("ping"===e.data){let o=["My caches are too strong for you, Debug.","You can't handle my caches. They're too strong for you.","My caches would kill you, Debug. You cannot handle my caches.","My strongest caches would kill you, Debug. You can't handle my strongest caches. You'd better go to a seller that sells weaker caches.","You don't know what you ask, Debug. My strongest caches will kill a dragon, let alone a man. You need a seller that sells weaker caches, because my caches are too strong.","You can't handle my strongest caches! No one can! My strongest caches aren't fit for a beast let alone a man.","I can't give you my strongest caches because my strongest caches are only for the strongest beings and you are of the weakest.","That's what you'd better do.","Good. You're not welcome here! My caches are only for the strongest and you're clearly are not of the strongest you're clearly the weakest.","Why respect HTML... when my caches can do anything that you can.",],n=Math.floor(Math.random()*o.length),s=o[n];sleepFor(2e3),consoleWrapperSimple(`[Service Worker] ${s}`)}});
